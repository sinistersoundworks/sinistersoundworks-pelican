<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}">
<head>
  {% if SITEURL == 'https://sinistersoundworks.com' %}
  <script defer data-domain="{{ ANALYTICS_DOMAIN }}" src="{{ ANALYTICS_URL }}"></script>
  {% endif %}

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="{{ SITE_DESCRIPTION }}" />
  <meta name="author" content="{{ AUTHOR }}" />
  
  <title>
    {% block title %}
    {% if page and page.title %}{{ page.title }} | {{ SITENAME }}{% elif article and article.title %}{{ article.title }} | {{ SITENAME }}{% else %}{{ SITENAME }}{% endif %}
    {% endblock %}
  </title>

  <!-- Bootstrap core CSS -->
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Custom fonts for this template -->
  <link href="/assets/css/all.min.css" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;500&display=swap" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@200;300;400;500;700&display=swap" rel="stylesheet" type="text/css" />

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" />
  <link rel="manifest" href="/assets/site.webmanifest" />
  
  <!-- Custom styles for this theme -->
  <link href="/assets/css/agency.css" rel="stylesheet" />
  <link href="/assets/css/custom.css" rel="stylesheet" />
  <link href="/assets/img/favicon.png" rel="shortcut icon" type="image/png" />

  <!-- Plyr CSS -->
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.3/plyr.css" />
  
  <!-- LineIcons -->
  <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />

  {% if page and page.template == "page" %}
  <!-- Page-specific styles are now in custom.css -->
  {% endif %}

</head>

<body id="page-top">
  {% include 'navbar.html' %}
  
  {% block content %}
  {% endblock %}
  
  {% include 'footer.html' %}

  <!-- Bootstrap core JavaScript -->
  <script src="/assets/js/bootstrap.bundle.min.js"></script>
  
  <!-- Plugin JavaScript -->
  <script src="/assets/js/agency.min.js"></script>
  
  
  <!-- Plyr -->
  <script src="https://cdn.plyr.io/3.7.3/plyr.polyfilled.js"></script>
  <script>
    const controls = `
    <div class="plyr__controls">
      <button type="button" class="plyr__control" data-plyr="restart">
        <svg role="presentation"><use xlink:href="#plyr-restart"></use></svg>
        <span class="plyr__tooltip" role="tooltip">Restart</span>
      </button>
      <button type="button" class="plyr__control" data-plyr="rewind">
        <svg role="presentation"><use xlink:href="#plyr-rewind"></use></svg>
        <span class="plyr__tooltip" role="tooltip">Rewind {seektime} secs</span>
      </button>
      <button type="button" class="plyr__control" aria-label="Play, {title}" data-plyr="play">
        <svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-pause"></use></svg>
        <svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-play"></use></svg>
        <span class="label--pressed plyr__tooltip" role="tooltip">Pause</span>
        <span class="label--not-pressed plyr__tooltip" role="tooltip">Play</span>
      </button>
      <button type="button" class="plyr__control" data-plyr="fast-forward">
        <svg role="presentation"><use xlink:href="#plyr-fast-forward"></use></svg>
        <span class="plyr__tooltip" role="tooltip">Forward {seektime} secs</span>
      </button>
      <div class="plyr__progress">
        <input data-plyr="seek" type="range" min="0" max="100" step="0.01" value="0" aria-label="Seek">
        <progress class="plyr__progress__buffer" min="0" max="100" value="0">% buffered</progress>
        <span role="tooltip" class="plyr__tooltip">00:00</span>
      </div>
      <div class="plyr__time plyr__time--current" aria-label="Current time">00:00</div>
      <div class="plyr__time plyr__time--duration" aria-label="Duration">00:00</div>
      <button type="button" class="plyr__control" aria-label="Mute" data-plyr="mute">
        <svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-muted"></use></svg>
        <svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-volume"></use></svg>
        <span class="label--pressed plyr__tooltip" role="tooltip">Unmute</span>
        <span class="label--not-pressed plyr__tooltip" role="tooltip">Mute</span>
      </button>
      <div class="plyr__volume">
        <input data-plyr="volume" type="range" min="0" max="1" step="0.05" value="1" autocomplete="off" aria-label="Volume">
      </div>
    </div>
    `;
    const players = Array.from(document.querySelectorAll('.plyr-audio', { controls })).map((p) => new Plyr(p));
    
    // Add mutual exclusion - pause other players when one starts playing
    players.forEach((player, index) => {
      player.on('play', () => {
        players.forEach((otherPlayer, otherIndex) => {
          if (otherIndex !== index && !otherPlayer.paused) {
            otherPlayer.pause();
          }
        });
      });
    });
    
    // Set current year in footer
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('current-year').textContent = new Date().getFullYear();
      
      // Smooth scrolling for navigation links
      document.querySelectorAll('a.js-scroll-trigger').forEach(function(link) {
        link.addEventListener('click', function(e) {
          const href = this.getAttribute('href');
          if (href.startsWith('#')) {
            e.preventDefault();
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          }
        });
      });
      
      // Navbar scroll background change
      const navbar = document.querySelector('.navbar');
      if (navbar) {
        window.addEventListener('scroll', function() {
          if (window.scrollY > 100) {
            navbar.classList.add('scrolled');
          } else {
            navbar.classList.remove('scrolled');
          }
        });
      }
    });
  </script>
</body>
</html>
